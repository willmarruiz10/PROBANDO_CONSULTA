<!DOCTYPE html>
<html>
<head>
    <title>Prueba del Sistema</title>
    <meta charset="UTF-8">
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 40px auto; padding: 20px; }
        button { padding: 10px 15px; margin: 10px; background: #4285f4; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #3367d6; }
        button:disabled { background: #ccc; cursor: not-allowed; }
        #resultado { background: #f5f5f5; padding: 15px; margin-top: 20px; border-radius: 4px; white-space: pre-wrap; min-height: 100px; }
        .loading { color: #666; font-style: italic; }
        .success { color: #0a0; border-left: 4px solid #0a0; }
        .error { color: #a00; border-left: 4px solid #a00; }
        .info { color: #333; border-left: 4px solid #4285f4; }
    </style>
</head>
<body>
    <h1>üîß Prueba del Sistema de Consulta</h1>
    <p>Prueba de conexi√≥n con Google Apps Script</p>
    
    <button onclick="probarBackend()" id="btnBackend">1. Probar Backend</button>
    <button onclick="obtenerDatos()" id="btnDatos">2. Obtener Datos P√∫blicos</button>
    <button onclick="agregarDatosPrueba()" id="btnAgregar">3. Agregar Datos de Prueba</button>
    
    <div id="resultado" class="info">Haga clic en un bot√≥n para comenzar...</div>

    <script>
        // REEMPLACE ESTA URL CON SU URL DE APPS SCRIPT
        const URL_BACKEND = "https://script.google.com/macros/s/AKfycbxzgouYew3YUNiNOaQcCEoLAT3gNUuUwU12iCk5bEZRzvQIslC-KSfFl6SatppjMB1Xvg/exec";
        
        function mostrarResultado(mensaje, tipo = 'info') {
            const resultado = document.getElementById('resultado');
            resultado.textContent = mensaje;
            resultado.className = tipo;
        }
        
        function setLoading(estado) {
            document.getElementById('btnBackend').disabled = estado;
            document.getElementById('btnDatos').disabled = estado;
            document.getElementById('btnAgregar').disabled = estado;
        }
        
        // FUNCI√ìN MEJORADA para llamar a Apps Script
        async function llamarAPI(action, params = {}) {
            setLoading(true);
            
            try {
                // Construir URL con par√°metros
                let url = `${URL_BACKEND}?action=${action}`;
                for (const [key, value] of Object.entries(params)) {
                    url += `&${key}=${encodeURIComponent(value)}`;
                }
                
                // Usar no-cors para evitar problemas (pero limita la respuesta)
                const respuesta = await fetch(url, {
                    method: 'GET',
                    mode: 'no-cors'  // Esto evita errores de CORS
                });
                
                // En modo 'no-cors' no podemos leer la respuesta, pero sabemos que se envi√≥
                // Para pruebas simples, asumimos √©xito despu√©s de un tiempo
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                return {
                    success: true,
                    message: `‚úÖ Solicitud '${action}' enviada correctamente al servidor`
                };
                
            } catch (error) {
                return {
                    success: false,
                    message: `‚ùå Error de conexi√≥n: ${error.message}`
                };
            } finally {
                setLoading(false);
            }
        }
        
        async function probarBackend() {
            mostrarResultado('üîç Probando conexi√≥n con el backend...', 'loading');
            const resultado = await llamarAPI('holaMundo');
            mostrarResultado(resultado.message, resultado.success ? 'success' : 'error');
        }
        
        async function obtenerDatos() {
            mostrarResultado('üìä Solicitando datos p√∫blicos...', 'loading');
            const resultado = await llamarAPI('obtenerDatosPublicos');
            mostrarResultado(resultado.message, resultado.success ? 'success' : 'error');
        }
        
        async function agregarDatosPrueba() {
            mostrarResultado('‚ûï Agregando datos de prueba manualmente...', 'loading');
            
            // Agregar datos manualmente a la hoja para prueba
            try {
                const ss = SpreadsheetApp.getActiveSpreadsheet();
                const hoja = ss.getSheetByName('Datos_Principales');
                
                // Si est√° vac√≠a, agregar encabezados
                if (hoja.getLastRow() === 0) {
                    hoja.getRange(1, 1, 1, 7).setValues([[
                        'ID', 'Nombre', 'Telefono', 'Email', 'Direccion', 'Fecha_Creacion', 'Fecha_Modificacion'
                    ]]);
                }
                
                // Agregar datos de prueba
                const nuevosDatos = [
                    [1, 'Juan P√©rez', '123456789', 'juan@test.com', 'Calle 123', new Date(), new Date()],
                    [2, 'Mar√≠a Garc√≠a', '987654321', 'maria@test.com', 'Avenida 456', new Date(), new Date()]
                ];
                
                hoja.getRange(hoja.getLastRow() + 1, 1, nuevosDatos.length, 7).setValues(nuevosDatos);
                
                mostrarResultado('‚úÖ Datos de prueba agregados manualmente. Ahora puede probar "Obtener Datos P√∫blicos".', 'success');
            } catch (error) {
                mostrarResultado('‚ùå Error al agregar datos: ' + error.message, 'error');
            } finally {
                setLoading(false);
            }
        }
        
        // Probar autom√°ticamente al cargar
        window.addEventListener('load', function() {
            mostrarResultado('‚úÖ Sistema listo para pruebas. Haga clic en "Probar Backend" para comenzar.', 'info');
        });
    </script>
</body>
</html>
